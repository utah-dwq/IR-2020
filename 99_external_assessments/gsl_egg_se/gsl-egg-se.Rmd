---
title: "IR 2020 GSL bird egg Selenium assessment"
author: "Jake Vander Laan, Utah Division of Water Quality"
date: "`r Sys.Date()`"
output: rmarkdown::html_document
---

```{r, eval=F, echo=F}
setwd('P:/WQ/Integrated Report/IR_2020/2020-IR-assessments/assessment/99_external_assessments/gsl_egg_se')
```

# Introduction
This page documents the data analysis process used to assess selenium in bird egg tissue for bird eggs collected in the Gilbert Bay assessment unit. 
The applicable criterion for Se in bird eggs for Gilbert Bay is a nesting season geomean of 12.5 mg/kg dry weight ([UAC R317-2-14, table 2.14.2](https://rules.utah.gov/publicat/code/r317/r317-002.htm#T16){target="_blank"}). 
All data used in this assessment are reported as dry weight. 

------

# Read data
```{r, read-data}
sites=as.data.frame(readxl::read_excel('GSL-egg-Se-DWQ.xls', 'Monitoring Locations'))
names(sites)=gsub(" ", "", names(sites))
names(sites)[names(sites)=='MonitoringLocationID']='MonitoringLocationIdentifier'
results=as.data.frame(readxl::read_excel('GSL-egg-Se-DWQ.xls', 'Results'))
names(results)=gsub(" ", "", names(results))
names(results)[names(results)=='MonitoringLocationID']='MonitoringLocationIdentifier'
```

# Site map
```{r, site-map, fig.cap='Figure 1. Egg collection monitoring locations.'}
wqTools::buildMap(sites=sites) %>% showGroup('Assessment units') %>% leaflet::fitBounds(min(sites$LongitudeMeasure)*0.999, min(sites$LatitudeMeasure)*0.999, max(sites$LongitudeMeasure)*1.001, max(sites$LatitudeMeasure)*1.001)
```

# Assign AUs
```{r, assign-aus}
sites=wqTools::assignAUs(sites)
```
*Note - only three sites are witihn the Gilbert Bay AU and used for this assessment.*  

# Subset to Gilbert Bay sites
```{r, subset-gb}
dim(results)
results=merge(results, sites)
dim(results)
results=subset(results, ASSESS_ID=='UT-L-16020310-001_00')
```

# Calculate geomeans by nesting season (year)
```{r, ann-gm}
gm_mean=function(x){
	return(exp(mean(log(x))))
}
results$year=lubridate::year(results$ActivityStartDate)
ann_gm=reshape2::dcast(results, year~MonitoringLocationIdentifier, value.var='ResultValue', fun.aggregate=gm_mean)
ann_gm=round(ann_gm, 2)
knitr::kable(ann_gm, caption='Table 1. Bird egg Se concentration geomeans by location and year.')
```

```{r, echo=F}
options(warn=-1)
```

# Boxplot
```{r, boxplot, message=FALSE, warning=FALSE, fig.cap='Figure 2. Boxplot of egg selenium concentrations among sites and years in the Gilbert Bay assessment unit.'}
library(plotly)
plot_ly(data=results, type='box') %>%
	add_trace(x=~year, y=~ResultValue, name=~MonitoringLocationIdentifier) %>% 
		layout(
			boxmode = "group",
			xaxis = list(title = "Year"),
			yaxis = list(side = 'left', title = 'Egg [Se] (mg/kg dry weight)')
		) %>% 
		config(displaylogo = FALSE,
			modeBarButtonsToRemove = c(
				'sendDataToCloud',
				'hoverClosestCartesian',
				'hoverCompareCartesian',
				'lasso2d',
				'select2d'
			)
		)
```

------

# Assessment narrative
Because all nesting season geomeans are less than the applicable numeric criterion of 12.5 mg/kg dry weight, Gilbert Bay is fully supporting for the class 5A bird egg selenium criterion. In addition, all seasonal geomeans were 
lower than the lowest egg Se concentration trigger identified in R317-2-14 (5.0 mg/kg). DWQ will continue routine monitoring of egg tissue in GSL.

------
 
$~$


$~$

